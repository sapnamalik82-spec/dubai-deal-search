function doGet(e) {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getSheetByName("Deals");
    if (!sheet) {
      throw new Error("Sheet 'Deals' not found. Please check the sheet name.");
    }

    const data = sheet.getDataRange().getValues();
    const query = (e?.parameter?.restaurant || "").toLowerCase();
    const results = [];

    for (let i = 1; i < data.length; i++) {  // skip header row
      const row = data[i];

      const restaurant = row[0] ? row[0].toString() : "";
      const deal = row[1] ? row[1].toString() : "";
      const source = row[2] ? row[2].toString() : "";
      const link = row[3] ? row[3].toString() : "";
      const validTill = row[4] ? row[4].toString() : "";

      if (!query || restaurant.toLowerCase().includes(query)) {
        results.push({
          restaurant,
          deal,
          source,
          link,
          validTill
        });
      }
    }

    return ContentService
      .createTextOutput(JSON.stringify(results))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    console.error("Error in doGet:", err);
    return ContentService
      .createTextOutput(JSON.stringify({ error: err.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
